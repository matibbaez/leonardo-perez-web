---
// src/components/FAQItem.astro 
interface Props {
    title: string;
    answer: string;
}
const { title, answer } = Astro.props;

// Generamos un ID único y eliminamos referencias de getElementById del script
const uniqueId = `faq-${Math.random().toString(36).substring(2, 9)}`;
---

<div id={`${uniqueId}-wrapper`} 
    class="faq-item-wrapper bg-white p-5 rounded-lg shadow-md border-b-2 border-azure/30 transition-all duration-300 hover:shadow-lg cursor-pointer">
    
    <div id={`${uniqueId}-header`} class="faq-header flex justify-between items-center cursor-pointer">
        <h4 class="font-bold text-navy-900 text-lg">{title}</h4>
        <span id={`${uniqueId}-icon`} class="text-azure text-2xl transform transition-transform duration-300 font-light">+</span>
    </div>

    <div id={`${uniqueId}-content`} class="faq-content overflow-hidden max-h-0 transition-[max-height] duration-500 ease-in-out">
        <p class="text-slate-600 pt-3 text-sm leading-relaxed border-t border-slate-200 mt-3 min-h-20">
            {answer}
        </p>
    </div>
</div>

<script define:vars={{ uniqueId }}>
    function initializeFAQ() {
        // Usamos querySelector para mayor robustez en el DOM
        const wrapper = document.getElementById(`${uniqueId}-wrapper`);
        const header = document.getElementById(`${uniqueId}-header`);
        const content = document.getElementById(`${uniqueId}-content`);
        const icon = document.getElementById(`${uniqueId}-icon`);
        
        let isOpen = false;

        // 1. CHEQUEO DE SEGURIDAD (Si falta algo, se detiene)
        if (!wrapper || !header || !content || !icon) return; 

        function toggleAccordion() {
            isOpen = !isOpen;

            if (isOpen) {
                // ABRIR: Usamos scrollHeight para el cálculo de altura (propiedad que SÍ existe en tiempo de ejecución)
                content.style.maxHeight = content.scrollHeight + 'px';
                icon.style.transform = 'rotate(45deg)';
                wrapper.classList.add('bg-blue-50/50', 'shadow-lg');
            } else {
                // CERRAR
                content.style.maxHeight = '0';
                icon.style.transform = 'rotate(0deg)';
                wrapper.classList.remove('bg-blue-50/50', 'shadow-lg');
            }
        }

        // 2. EVENT LISTENER
        header.addEventListener('click', toggleAccordion);

        // Inicialización
        content.style.maxHeight = '0';
    }

    // Usamos setTimeout para asegurar que se ejecute después del renderizado del DOM
    setTimeout(initializeFAQ, 0); 
</script>